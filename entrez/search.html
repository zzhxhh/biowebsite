<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿç‰©ä¿¡æ¯å­¦æœç´¢ - ç®€å•æ•°æ®åº“æ£€ç´¢å·¥å…·</title>
    <meta name="description" content="åŸºäºNCBI Entrez APIçš„ç®€å•ç”Ÿç‰©ä¿¡æ¯å­¦æ•°æ®åº“æœç´¢å·¥å…·ï¼Œæ”¯æŒPubMedã€Geneã€Proteinç­‰æ•°æ®åº“æ£€ç´¢ï¼Œæä¾›åŸºç¡€çš„å¯è§†åŒ–ç»“æœå±•ç¤ºã€‚">

    <!-- å¤–éƒ¨èµ„æº -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- ä¸»ç½‘ç«™æ ·å¼ -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../pet/pixel-cat.css">
    
    <!-- æœç´¢é¡µé¢ä¸“ç”¨æ ·å¼ -->
    <link rel="stylesheet" href="css/search-page.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar" data-aos="fade-down">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-robot"></i>
                <span>ç½‘ç«™å¯¼èˆª</span>
            </div>

            <div class="nav-menu">
                <a href="../index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    é¦–é¡µ
                </a>

                <a href="../about.html" class="nav-link">
                    <i class="fas fa-info-circle"></i>
                    å…³äºæˆ‘ä»¬
                </a>

                <!-- ç”¨æˆ·èœå• - é€šè¿‡JavaScriptåŠ¨æ€æ§åˆ¶æ˜¾ç¤º -->
                <div id="userMenuLoggedIn" class="user-menu-section" style="display: none;">
                    <a href="../favorites.html" class="nav-link">
                        <i class="fas fa-heart"></i>
                        æˆ‘çš„æ”¶è—
                    </a>
                    <div class="user-menu">
                        <span class="user-name">
                            <i class="fas fa-user"></i>
                            <span id="usernameDisplay"></span>
                        </span>
                        <a href="#" class="nav-link" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            é€€å‡º
                        </a>
                    </div>
                </div>

                <div id="userMenuLoggedOut" class="user-menu-section">
                    <a href="#" class="nav-link" id="loginLink">
                        <i class="fas fa-sign-in-alt"></i>
                        ç™»å½•
                    </a>
                    <a href="#" class="nav-link" id="registerLink">
                        <i class="fas fa-user-plus"></i>
                        æ³¨å†Œ
                    </a>
                </div>

                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="main-content">
        <!-- æœç´¢é¡µé¢å¤´éƒ¨ -->
        <section class="search-hero" data-aos="fade-up">
            <div class="container">
                <h1><i class="fas fa-dna"></i> ç”Ÿç‰©ä¿¡æ¯å­¦æœç´¢</h1>
                <p>åŸºäºNCBI Entrez APIå¼€å‘çš„ç®€å•ç”Ÿç‰©ä¿¡æ¯æ•°æ®åº“æœç´¢å·¥å…·</p>
                <p>æ”¯æŒPubMedæ–‡çŒ®ã€GeneåŸºå› ã€Proteinè›‹ç™½è´¨ç­‰æ•°æ®åº“çš„åŸºç¡€æ£€ç´¢åŠŸèƒ½</p>
            </div>
        </section>

        <!-- æœç´¢åŠŸèƒ½åŒºåŸŸ -->
        <section class="search-section" data-aos="fade-up" data-aos-delay="200">
            <div class="container">
                <div class="search-card">
                    <form id="searchForm">
                        <div class="search-form">
                            <div class="form-group">
                                <label for="database">æ•°æ®åº“</label>
                                <select id="database" name="database">
                                    <option value="pubmed">PubMed (æ–‡çŒ®)</option>
                                    <option value="gene">Gene (åŸºå› )</option>
                                    <option value="protein">Protein (è›‹ç™½è´¨)</option>
                                    <option value="nucleotide">Nucleotide (æ ¸é…¸)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="keyword">æœç´¢å…³é”®è¯</label>
                                <input type="text" id="keyword" name="keyword" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." required>
                            </div>

                            <div class="form-group">
                                <label for="method">æœç´¢æ–¹å¼</label>
                                <select id="method" name="method">
                                    <option value="get">GET æ–¹å¼</option>
                                    <option value="post">POST æ–¹å¼</option>
                                    <option value="session">SESSION æ–¹å¼</option>
                                </select>
                            </div>
                        </div>

                        <div class="search-buttons">
                            <button type="submit" class="search-btn" id="searchBtn">
                                <i class="fas fa-search"></i> æœç´¢
                            </button>
                            <button type="button" class="search-btn" id="testBtn" style="margin-left: 10px;">
                                <i class="fas fa-flask"></i> æµ‹è¯•å¯è§†åŒ–
                            </button>
                        </div>
                    </form>

                    <!-- è¿›åº¦æ¡ -->
                    <div class="progress" id="progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">å‡†å¤‡æœç´¢...</div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="loading" id="loading">
                        <i class="fas fa-spinner"></i>
                        <p>æ­£åœ¨æœç´¢ï¼Œè¯·ç¨å€™...</p>
                    </div>

                    <!-- æœç´¢ç»“æœ -->
                    <div class="results" id="results">
                        <div class="result-header">
                            <div class="result-count" id="resultCount"></div>
                            <div class="result-controls">
                                <button class="view-toggle-btn active" data-view="list" id="listViewBtn">
                                    <i class="fas fa-list"></i> åˆ—è¡¨è§†å›¾
                                </button>
                                <button class="view-toggle-btn" data-view="chart" id="chartViewBtn">
                                    <i class="fas fa-chart-bar"></i> å¯è§†åŒ–
                                </button>
                            </div>
                        </div>

                        <!-- åˆ—è¡¨è§†å›¾ -->
                        <div id="resultList" class="result-view active"></div>

                        <!-- å¯è§†åŒ–è§†å›¾ -->
                        <div id="chartView" class="result-view chart-container">
                            <div class="simple-charts">
                                <!-- ç¬¬ä¸€ä¸ªå›¾è¡¨ -->
                                <div class="chart-card">
                                    <h3 id="firstChartTitle">ğŸ“Š å¹´ä»½åˆ†å¸ƒ</h3>
                                    <canvas id="yearChart"></canvas>
                                </div>

                                <!-- ç»Ÿè®¡åˆ†å¸ƒå›¾ -->
                                <div class="chart-card">
                                    <h3>ğŸ“ˆ æ•°æ®ç»Ÿè®¡</h3>
                                    <canvas id="statsChart"></canvas>
                                </div>
                            </div>
                        </div>


                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer" data-aos="fade-up">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ğŸ§¬ ç”Ÿç‰©ä¿¡æ¯å­¦æœç´¢</h3>
                    <p>åŸºäºNCBI Entrez APIçš„ç®€å•ç”Ÿç‰©ä¿¡æ¯æ•°æ®åº“æœç´¢å·¥å…·ï¼Œæä¾›åŸºç¡€çš„æ•°æ®åº“æ£€ç´¢åŠŸèƒ½ã€‚</p>
                </div>
                <div class="footer-section">
                    <h4>ğŸ¯ åŠŸèƒ½ç‰¹è‰²</h4>
                    <ul>
                        <li>ğŸ” å¤šæ•°æ®åº“æ”¯æŒ</li>
                        <li>ğŸ“Š å¯è§†åŒ–ç»“æœå±•ç¤º</li>
                        <li>ğŸš€ ä¸‰ç§æœç´¢æ–¹å¼</li>
                        <li>ğŸ¨ å“åº”å¼è®¾è®¡</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ğŸ“Š æŠ€æœ¯å®ç°</h4>
                    <div class="footer-stats">
                        <p>ğŸ› ï¸ å­¦ä¹ é¡¹ç›®</p>
                        <p>ğŸ“‚ NCBI Entrez API</p>
                        <p>ğŸ†• åŸºç¡€æ•°æ®æ£€ç´¢</p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ç”Ÿç‰©ä¿¡æ¯å­¦æœç´¢å·¥å…· - å¼ å­è±ªçš„å­¦ä¹ é¡¹ç›® (2330416015). ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨.</p>
            </div>
        </div>
    </footer>

    <!-- çº¯GIFæ¡Œå®  -->
    <div id="pixel-cat-container">
        <div id="pixel-cat-menu" class="pixel-cat-menu">
            <div class="pixel-menu-item" data-action="home">ğŸ  å›åˆ°é¦–é¡µ</div>
            <div class="pixel-menu-item" data-action="top">â¬†ï¸ å›åˆ°é¡¶éƒ¨</div>
            <div class="pixel-menu-item" data-action="focus">ğŸ” èšç„¦æœç´¢æ¡†</div>
            <div class="pixel-menu-item" data-action="theme">ğŸ¨ åˆ‡æ¢ä¸»é¢˜</div>
            <div class="pixel-menu-item" data-action="singing">
                <i class="fas fa-music"></i>
                <span>è®©æˆ‘å”±æ­Œ</span>
            </div>
            <div class="pixel-menu-item" data-action="sleep">ğŸ˜´ ä¼‘æ¯</div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script src="js/simple-charts.js"></script>

    <script>
        // æœç´¢é¡µé¢ä¸“ç”¨è„šæœ¬







        // æç®€æœç´¢åº”ç”¨
        class SimpleSearchApp {
            constructor() {
                this.form = document.getElementById('searchForm');
                this.loading = document.getElementById('loading');
                this.results = document.getElementById('results');
                this.visualization = new SimpleVisualization();
                this.init();
            }

            init() {
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSearch();
                });
                this.bindViewToggle();
            }

            bindViewToggle() {
                const listViewBtn = document.getElementById('listViewBtn');
                const chartViewBtn = document.getElementById('chartViewBtn');

                listViewBtn?.addEventListener('click', () => this.switchView('list'));
                chartViewBtn?.addEventListener('click', () => this.switchView('chart'));
            }

            switchView(viewType) {
                const listViewBtn = document.getElementById('listViewBtn');
                const chartViewBtn = document.getElementById('chartViewBtn');
                const resultList = document.getElementById('resultList');
                const chartView = document.getElementById('chartView');

                if (viewType === 'list') {
                    listViewBtn?.classList.add('active');
                    chartViewBtn?.classList.remove('active');
                    resultList?.classList.add('active');
                    chartView?.classList.remove('active');
                } else {
                    listViewBtn?.classList.remove('active');
                    chartViewBtn?.classList.add('active');
                    resultList?.classList.remove('active');
                    chartView?.classList.add('active');
                }
            }

            async handleSearch() {
                const formData = new FormData(this.form);
                const database = formData.get('database');
                const keyword = formData.get('keyword')?.trim();
                const method = formData.get('method');

                if (!keyword) {
                    alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                    return;
                }

                this.showLoading(true);

                try {
                    const results = await this.search(database, keyword, method);
                    this.displayResults(results);
                } catch (error) {
                    this.showError(error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            async search(database, keyword, method) {
                const endpoints = {
                    get: 'api/search.php',
                    post: 'api/search_post.php',
                    session: 'api/search_session.php'
                };

                let response;

                if (method === 'get') {
                    const params = new URLSearchParams({
                        db: database,
                        term: keyword,
                        retmax: 20
                    });
                    response = await fetch(`${endpoints.get}?${params}`);
                } else {
                    const formData = new FormData();
                    formData.append('db', database);
                    formData.append('term', keyword);
                    formData.append('retmax', '20');

                    response = await fetch(endpoints[method], {
                        method: 'POST',
                        body: formData,
                        ...(method === 'session' && { credentials: 'include' })
                    });
                }

                if (!response.ok) {
                    throw new Error(`æœç´¢å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'æœç´¢å¤±è´¥');
                }

                return data;
            }

            displayResults(data) {
                const resultCount = document.getElementById('resultCount');
                const resultList = document.getElementById('resultList');

                if (resultCount) {
                    resultCount.textContent = `æ‰¾åˆ° ${data.count} æ¡ç»“æœï¼Œæ˜¾ç¤ºå‰ ${data.details.length} æ¡ (${data.method}æ–¹å¼)`;
                }

                if (resultList) {
                    resultList.innerHTML = '';
                    data.details.forEach(item => {
                        resultList.appendChild(this.createResultItem(item));
                    });
                }

                this.results.style.display = 'block';

                // ç”Ÿæˆç®€å•å›¾è¡¨
                this.visualization.generateCharts(data.database, data.details);
            }

            createResultItem(item) {
                const div = document.createElement('div');
                div.className = 'result-item';

                const title = item.title || 'æ— æ ‡é¢˜';
                const authors = Array.isArray(item.authors) ? item.authors.join(', ') : '';
                const journal = item.journal || '';
                const year = item.year || '';
                const abstract = item.abstract || 'æ— æ‘˜è¦';
                const url = item.url || '#';

                div.innerHTML = `
                    <div class="result-title">
                        <a href="${url}" target="_blank">${title}</a>
                    </div>
                    <div class="result-meta">
                        ${authors ? `ä½œè€…: ${authors}` : ''}
                        ${journal ? ` | æœŸåˆŠ: ${journal}` : ''}
                        ${year ? ` | å¹´ä»½: ${year}` : ''}
                        ${item.pmid ? ` | PMID: ${item.pmid}` : ''}
                    </div>
                    <div class="result-abstract">${abstract}</div>
                `;

                return div;
            }

            showLoading(show) {
                this.loading.style.display = show ? 'block' : 'none';
                const searchBtn = document.getElementById('searchBtn');
                if (searchBtn) searchBtn.disabled = show;
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;

                this.form.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }


        }

        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', () => {
            window.bioinfoSearchInstance = new SimpleSearchApp();

            // åˆå§‹åŒ–AOSåŠ¨ç”»
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // ç»‘å®šæµ‹è¯•æŒ‰é’®
            const testBtn = document.getElementById('testBtn');
            if (testBtn) {
                testBtn.addEventListener('click', () => {
                    if (window.bioinfoSearchInstance) {
                        window.bioinfoSearchInstance.testVisualization();
                    }
                });
            }

            // ç»‘å®šçŒ«å’ªèœå•åŠŸèƒ½
            const pixelCatMenu = document.getElementById('pixel-cat-menu');
            if (pixelCatMenu) {
                pixelCatMenu.addEventListener('click', (e) => {
                    const action = e.target.closest('.pixel-menu-item')?.dataset.action;
                    if (action) {
                        switch (action) {
                            case 'home':
                                window.location.href = '../index.html';
                                break;
                            case 'top':
                                window.scrollTo({ top: 0, behavior: 'smooth' });
                                break;
                            case 'focus':
                                document.getElementById('keyword')?.focus();
                                break;
                            case 'theme':
                                document.getElementById('themeToggle')?.click();
                                break;
                        }
                    }
                });
            }
        });

        // æ·»åŠ æµ‹è¯•å¯è§†åŒ–åŠŸèƒ½åˆ°æœç´¢åº”ç”¨ç±»
        SimpleSearchApp.prototype.testVisualization = function() {
            const mockData = {
                success: true,
                database: 'pubmed',
                method: 'test',
                count: 20,
                details: Array.from({length: 20}, (_, i) => ({
                    title: `Test Article ${i + 1}: Machine Learning in Bioinformatics`,
                    year: 2018 + Math.floor(Math.random() * 6),
                    authors: ['Smith J', 'Johnson A', 'Brown K'],
                    journal: 'Nature Biotechnology',
                    abstract: 'This is a sample abstract for testing visualization purposes...',
                    pmid: `12345${i}`,
                    url: '#'
                }))
            };
            this.displayResults(mockData);
        };










    </script>

    <!-- çº¯GIFæ¡Œå®  -->
    <script src="../pet/pixel-cat.js"></script>
</body>
</html>
